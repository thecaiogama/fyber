<html lang="en"><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Just saying hello to the fyber team :)">
    <meta name="author" content="Caio Gama - thecaiogama@gmail.com">
    <link rel="icon" href="../../favicon.ico">

    <title>Hi Fyber team :)</title>

    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
    <link href="cover.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="container-fluid">

      <div class="row">
        <div class="col-md-4">User ID: <input type="text" class="form-content" id="userId" placeholder="Insert User ID"></div>
        <div class="col-md-4">Custom Parameter: <input type="text" class="form-content" id="customParamenter" placeholder="Custom Parameter"></div>
        <div class="col-md-2">Page: <input type="text" class="form-content" id="pageNumber" size=2 value="1"></div>
        <div class="col-md-2"><input type="button" id="submit" class="btn btn-primary" value="Search"></div>
      </div>

      <div class="row" id="contentTarget">

      </div>

    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.1.0/mustache.min.js"></script>

    <script type="text/javascript">

      $("#submit").click(function(){
        if ( $('#userId').val().length === 0 || $('#customParamenter').val().length === 0 || $('#pageNumber').val().length === 0) {
          alert("Please, provide all the information required");
        } else {
          getOffers();
        }
      });

      $("#pageNumber").keydown(function (e) {
          if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
              (e.keyCode == 65 && e.ctrlKey === true) ||
              (e.keyCode == 67 && e.ctrlKey === true) ||
              (e.keyCode == 88 && e.ctrlKey === true) ||
              (e.keyCode >= 35 && e.keyCode <= 39)) {
                   return;
          }

          if ((e.shiftKey || (e.keyCode < 48 || e.keyCode > 57)) && (e.keyCode < 96 || e.keyCode > 105)) {
              e.preventDefault();
          }
      });

      function getOffers(){
        $("#contentTarget").html("Loading...");
        var url = "/offers/"+  $('#userId').val() +"/"+ $('#customParamenter').val() +"/"+ $('#pageNumber').val();

        $.get( url, function(data) {
          if(data.count > 0) {
            buildTable(data.count, data.offers)
          } else {
            $("#contentTarget").html("<b>No data was found, try another seacrh :(</b>");
          }

        });
      }

      function buildTable(count, offers){
        var table ="<table class='table' id='offers'><thead><th colspan='5'>Total of offers found: {{amount}}</th></thead><thead><tr><th>Offer id</th><th>Title</th><th>Teaser</th><th>Payout</th><th>Thumb</th></tr></thead></table>";

        var offersData = {
            amount: count
        }

        var offerHtml = Mustache.render(table, offersData);
        $("#contentTarget").html(offerHtml);

        buildData(offers)

      }

      function buildData(offers){
        var line = "<tr><td>{{offer_id}}</td><td><a href='{{link}}'>{{title}}</a></td><td>{{teaser}}</td><td>{{payout}}</td><td><img src='{{thumb}}'/></td></tr>"

        $.each(offers, function(index, offer) {
          console.log(offer);
          item = {
            offer_id: offer.offer_id,
            title: offer.title,
            link: offer.link,
            teaser: offer.teaser,
            payout: offer.payout,
            thumb: offer.thumbnail.lowres
          }

          var row = Mustache.render(line, item);
          $("#offers").append(row);
        });
      }
    </script>

</body></html>
